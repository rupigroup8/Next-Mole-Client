{"ast":null,"code":"import { WebGLRenderer, Scene, PerspectiveCamera, Raycaster, TextureLoader, Vector2, Vector3, Box3, Color, Mesh, SphereGeometry, MeshBasicMaterial, BackSide, EventDispatcher, MOUSE, Quaternion, Spherical, Clock } from 'three';\nimport { TrackballControls } from 'three/examples/jsm/controls/TrackballControls.js';\nimport { OrbitControls } from 'three/examples/jsm/controls/OrbitControls.js';\nimport { FlyControls } from 'three/examples/jsm/controls/FlyControls.js';\nimport { EffectComposer } from 'three/examples/jsm/postprocessing/EffectComposer.js';\nimport { RenderPass } from 'three/examples/jsm/postprocessing/RenderPass.js';\nimport { parseToRgb, opacify } from 'polished';\nimport TWEEN from '@tweenjs/tween.js';\nimport accessorFn from 'accessor-fn';\nimport Kapsule from 'kapsule';\n\nfunction styleInject(css, ref) {\n  if (ref === void 0) ref = {};\n  var insertAt = ref.insertAt;\n\n  if (!css || typeof document === 'undefined') {\n    return;\n  }\n\n  var head = document.head || document.getElementsByTagName('head')[0];\n  var style = document.createElement('style');\n  style.type = 'text/css';\n\n  if (insertAt === 'top') {\n    if (head.firstChild) {\n      head.insertBefore(style, head.firstChild);\n    } else {\n      head.appendChild(style);\n    }\n  } else {\n    head.appendChild(style);\n  }\n\n  if (style.styleSheet) {\n    style.styleSheet.cssText = css;\n  } else {\n    style.appendChild(document.createTextNode(css));\n  }\n}\n\nvar css_248z = \".scene-nav-info {\\n  bottom: 5px;\\n  width: 100%;\\n  text-align: center;\\n  color: slategrey;\\n  opacity: 0.7;\\n  font-size: 10px;\\n}\\n\\n.scene-tooltip {\\n  color: lavender;\\n  font-size: 15px;\\n}\\n\\n.scene-nav-info, .scene-tooltip {\\n  position: absolute;\\n  font-family: sans-serif;\\n  pointer-events: none;\\n}\";\nstyleInject(css_248z);\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nfunction _slicedToArray(arr, i) {\n  return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest();\n}\n\nfunction _toConsumableArray(arr) {\n  return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread();\n}\n\nfunction _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) return _arrayLikeToArray(arr);\n}\n\nfunction _arrayWithHoles(arr) {\n  if (Array.isArray(arr)) return arr;\n}\n\nfunction _iterableToArray(iter) {\n  if (typeof Symbol !== \"undefined\" && Symbol.iterator in Object(iter)) return Array.from(iter);\n}\n\nfunction _iterableToArrayLimit(arr, i) {\n  if (typeof Symbol === \"undefined\" || !(Symbol.iterator in Object(arr))) return;\n  var _arr = [];\n  var _n = true;\n  var _d = false;\n  var _e = undefined;\n\n  try {\n    for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) {\n      _arr.push(_s.value);\n\n      if (i && _arr.length === i) break;\n    }\n  } catch (err) {\n    _d = true;\n    _e = err;\n  } finally {\n    try {\n      if (!_n && _i[\"return\"] != null) _i[\"return\"]();\n    } finally {\n      if (_d) throw _e;\n    }\n  }\n\n  return _arr;\n}\n\nfunction _unsupportedIterableToArray(o, minLen) {\n  if (!o) return;\n  if (typeof o === \"string\") return _arrayLikeToArray(o, minLen);\n  var n = Object.prototype.toString.call(o).slice(8, -1);\n  if (n === \"Object\" && o.constructor) n = o.constructor.name;\n  if (n === \"Map\" || n === \"Set\") return Array.from(o);\n  if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);\n}\n\nfunction _arrayLikeToArray(arr, len) {\n  if (len == null || len > arr.length) len = arr.length;\n\n  for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];\n\n  return arr2;\n}\n\nfunction _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\n\nfunction _nonIterableRest() {\n  throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\n\nvar three = window.THREE ? window.THREE // Prefer consumption from global THREE, if exists\n: {\n  WebGLRenderer: WebGLRenderer,\n  Scene: Scene,\n  PerspectiveCamera: PerspectiveCamera,\n  Raycaster: Raycaster,\n  TextureLoader: TextureLoader,\n  Vector2: Vector2,\n  Vector3: Vector3,\n  Box3: Box3,\n  Color: Color,\n  Mesh: Mesh,\n  SphereGeometry: SphereGeometry,\n  MeshBasicMaterial: MeshBasicMaterial,\n  BackSide: BackSide,\n  EventDispatcher: EventDispatcher,\n  MOUSE: MOUSE,\n  Quaternion: Quaternion,\n  Spherical: Spherical,\n  Clock: Clock\n};\nvar threeRenderObjects = Kapsule({\n  props: {\n    width: {\n      \"default\": window.innerWidth,\n      onChange: function onChange(width, state, prevWidth) {\n        isNaN(width) && (state.width = prevWidth);\n      }\n    },\n    height: {\n      \"default\": window.innerHeight,\n      onChange: function onChange(height, state, prevHeight) {\n        isNaN(height) && (state.height = prevHeight);\n      }\n    },\n    backgroundColor: {\n      \"default\": '#000011'\n    },\n    backgroundImageUrl: {},\n    onBackgroundImageLoaded: {},\n    showNavInfo: {\n      \"default\": true\n    },\n    skyRadius: {\n      \"default\": 50000\n    },\n    objects: {\n      \"default\": []\n    },\n    enablePointerInteraction: {\n      \"default\": true,\n      onChange: function onChange(_, state) {\n        // Reset hover state\n        state.hoverObj = null;\n        if (state.toolTipElem) state.toolTipElem.innerHTML = '';\n      },\n      triggerUpdate: false\n    },\n    lineHoverPrecision: {\n      \"default\": 1,\n      triggerUpdate: false\n    },\n    hoverOrderComparator: {\n      \"default\": function _default() {\n        return -1;\n      },\n      triggerUpdate: false\n    },\n    // keep existing order by default\n    hoverFilter: {\n      \"default\": function _default() {\n        return true;\n      },\n      triggerUpdate: false\n    },\n    // exclude objects from interaction\n    tooltipContent: {\n      triggerUpdate: false\n    },\n    hoverDuringDrag: {\n      \"default\": false,\n      triggerUpdate: false\n    },\n    clickAfterDrag: {\n      \"default\": false,\n      triggerUpdate: false\n    },\n    onHover: {\n      \"default\": function _default() {},\n      triggerUpdate: false\n    },\n    onClick: {\n      \"default\": function _default() {},\n      triggerUpdate: false\n    },\n    onRightClick: {\n      triggerUpdate: false\n    }\n  },\n  methods: {\n    tick: function tick(state) {\n      if (state.initialised) {\n        state.controls.update && state.controls.update(state.clock.getDelta()); // timedelta is required for fly controls\n\n        state.postProcessingComposer ? state.postProcessingComposer.render() // if using postprocessing, switch the output to it\n        : state.renderer.render(state.scene, state.camera);\n\n        if (state.enablePointerInteraction) {\n          // Update tooltip and trigger onHover events\n          var topObject = null;\n\n          if (state.hoverDuringDrag || !state.isPointerDragging) {\n            var intersects = this.intersectingObjects(state.pointerPos.x, state.pointerPos.y).map(function (_ref) {\n              var object = _ref.object;\n              return object;\n            }).filter(state.hoverFilter).sort(state.hoverOrderComparator);\n            topObject = intersects.length ? intersects[0] : null;\n          }\n\n          if (topObject !== state.hoverObj) {\n            state.onHover(topObject, state.hoverObj);\n            state.toolTipElem.innerHTML = topObject ? accessorFn(state.tooltipContent)(topObject) || '' : '';\n            state.hoverObj = topObject;\n          }\n        }\n\n        TWEEN.update(); // update camera animation tweens\n      }\n\n      return this;\n    },\n    getPointerPos: function getPointerPos(state) {\n      var _state$pointerPos = state.pointerPos,\n          x = _state$pointerPos.x,\n          y = _state$pointerPos.y;\n      return {\n        x: x,\n        y: y\n      };\n    },\n    cameraPosition: function cameraPosition(state, position, lookAt, transitionDuration) {\n      var camera = state.camera; // Setter\n\n      if (position && state.initialised) {\n        var finalPos = position;\n        var finalLookAt = lookAt || {\n          x: 0,\n          y: 0,\n          z: 0\n        };\n\n        if (!transitionDuration) {\n          // no animation\n          setCameraPos(finalPos);\n          setLookAt(finalLookAt);\n        } else {\n          var camPos = Object.assign({}, camera.position);\n          var camLookAt = getLookAt();\n          new TWEEN.Tween(camPos).to(finalPos, transitionDuration).easing(TWEEN.Easing.Quadratic.Out).onUpdate(setCameraPos).start(); // Face direction in 1/3rd of time\n\n          new TWEEN.Tween(camLookAt).to(finalLookAt, transitionDuration / 3).easing(TWEEN.Easing.Quadratic.Out).onUpdate(setLookAt).start();\n        }\n\n        return this;\n      } // Getter\n\n\n      return Object.assign({}, camera.position, {\n        lookAt: getLookAt()\n      }); //\n\n      function setCameraPos(pos) {\n        var x = pos.x,\n            y = pos.y,\n            z = pos.z;\n        if (x !== undefined) camera.position.x = x;\n        if (y !== undefined) camera.position.y = y;\n        if (z !== undefined) camera.position.z = z;\n      }\n\n      function setLookAt(lookAt) {\n        state.controls.target = new three.Vector3(lookAt.x, lookAt.y, lookAt.z);\n      }\n\n      function getLookAt() {\n        return Object.assign(new three.Vector3(0, 0, -1000).applyQuaternion(camera.quaternion).add(camera.position));\n      }\n    },\n    zoomToFit: function zoomToFit(state) {\n      var transitionDuration = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;\n      var padding = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 10;\n\n      for (var _len = arguments.length, bboxArgs = new Array(_len > 3 ? _len - 3 : 0), _key = 3; _key < _len; _key++) {\n        bboxArgs[_key - 3] = arguments[_key];\n      }\n\n      return this.fitToBbox(this.getBbox.apply(this, bboxArgs), transitionDuration, padding);\n    },\n    fitToBbox: function fitToBbox(state, bbox) {\n      var transitionDuration = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;\n      var padding = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 10; // based on https://discourse.threejs.org/t/camera-zoom-to-fit-object/936/24\n\n      var camera = state.camera;\n\n      if (bbox) {\n        var center = new three.Vector3(0, 0, 0); // reset camera aim to center\n\n        var maxBoxSide = Math.max.apply(Math, _toConsumableArray(Object.entries(bbox).map(function (_ref2) {\n          var _ref3 = _slicedToArray(_ref2, 2),\n              coordType = _ref3[0],\n              coords = _ref3[1];\n\n          return Math.max.apply(Math, _toConsumableArray(coords.map(function (c) {\n            return Math.abs(center[coordType] - c);\n          })));\n        }))) * 2; // find distance that fits whole bbox within padded fov\n\n        var paddedFov = (1 - padding * 2 / state.height) * camera.fov;\n        var fitHeightDistance = maxBoxSide / Math.atan(paddedFov * Math.PI / 180);\n        var fitWidthDistance = fitHeightDistance / camera.aspect;\n        var distance = Math.max(fitHeightDistance, fitWidthDistance);\n\n        if (distance > 0) {\n          var newCameraPosition = center.clone().sub(camera.position).normalize().multiplyScalar(-distance);\n          this.cameraPosition(newCameraPosition, center, transitionDuration);\n        }\n      }\n\n      return this;\n    },\n    getBbox: function getBbox(state) {\n      var objFilter = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : function () {\n        return true;\n      };\n      var box = new three.Box3(new three.Vector3(0, 0, 0), new three.Vector3(0, 0, 0));\n      var objs = state.objects.filter(objFilter);\n      if (!objs.length) return null;\n      objs.forEach(function (obj) {\n        return box.expandByObject(obj);\n      }); // extract global x,y,z min/max\n\n      return Object.assign.apply(Object, _toConsumableArray(['x', 'y', 'z'].map(function (c) {\n        return _defineProperty({}, c, [box.min[c], box.max[c]]);\n      })));\n    },\n    getScreenCoords: function getScreenCoords(state, x, y, z) {\n      var vec = new three.Vector3(x, y, z);\n      vec.project(this.camera()); // project to the camera plane\n\n      return {\n        // align relative pos to canvas dimensions\n        x: (vec.x + 1) * state.width / 2,\n        y: -(vec.y - 1) * state.height / 2\n      };\n    },\n    intersectingObjects: function intersectingObjects(state, x, y) {\n      var relCoords = new three.Vector2(x / state.width * 2 - 1, -(y / state.height) * 2 + 1);\n      var raycaster = new three.Raycaster();\n      raycaster.params.Line.threshold = state.lineHoverPrecision; // set linePrecision\n\n      raycaster.setFromCamera(relCoords, state.camera);\n      return raycaster.intersectObjects(state.objects, true);\n    },\n    renderer: function renderer(state) {\n      return state.renderer;\n    },\n    scene: function scene(state) {\n      return state.scene;\n    },\n    camera: function camera(state) {\n      return state.camera;\n    },\n    postProcessingComposer: function postProcessingComposer(state) {\n      return state.postProcessingComposer;\n    },\n    controls: function controls(state) {\n      return state.controls;\n    },\n    tbControls: function tbControls(state) {\n      return state.controls;\n    } // to be deprecated\n\n  },\n  stateInit: function stateInit() {\n    return {\n      scene: new three.Scene(),\n      camera: new three.PerspectiveCamera(),\n      clock: new three.Clock()\n    };\n  },\n  init: function init(domNode, state, _ref5) {\n    var _ref5$controlType = _ref5.controlType,\n        controlType = _ref5$controlType === void 0 ? 'trackball' : _ref5$controlType,\n        _ref5$rendererConfig = _ref5.rendererConfig,\n        rendererConfig = _ref5$rendererConfig === void 0 ? {} : _ref5$rendererConfig,\n        _ref5$waitForLoadComp = _ref5.waitForLoadComplete,\n        waitForLoadComplete = _ref5$waitForLoadComp === void 0 ? true : _ref5$waitForLoadComp; // Wipe DOM\n\n    domNode.innerHTML = ''; // Add relative container\n\n    domNode.appendChild(state.container = document.createElement('div'));\n    state.container.style.position = 'relative'; // Add nav info section\n\n    state.container.appendChild(state.navInfo = document.createElement('div'));\n    state.navInfo.className = 'scene-nav-info';\n    state.navInfo.textContent = {\n      orbit: 'Left-click: rotate, Mouse-wheel/middle-click: zoom, Right-click: pan',\n      trackball: 'Left-click: rotate, Mouse-wheel/middle-click: zoom, Right-click: pan',\n      fly: 'WASD: move, R|F: up | down, Q|E: roll, up|down: pitch, left|right: yaw'\n    }[controlType] || '';\n    state.navInfo.style.display = state.showNavInfo ? null : 'none'; // Setup tooltip\n\n    state.toolTipElem = document.createElement('div');\n    state.toolTipElem.classList.add('scene-tooltip');\n    state.container.appendChild(state.toolTipElem); // Capture pointer coords on move or touchstart\n\n    state.pointerPos = new three.Vector2();\n    state.pointerPos.x = -2; // Initialize off canvas\n\n    state.pointerPos.y = -2;\n    ['pointermove', 'pointerdown'].forEach(function (evType) {\n      return state.container.addEventListener(evType, function (ev) {\n        // detect point drag\n        !state.isPointerDragging && ev.type === 'pointermove' && ev.pressure > 0 && (ev.movementX !== 0 || ev.movementY !== 0) && (state.isPointerDragging = true);\n\n        if (state.enablePointerInteraction) {\n          // update the pointer pos\n          var offset = getOffset(state.container);\n          state.pointerPos.x = ev.pageX - offset.left;\n          state.pointerPos.y = ev.pageY - offset.top; // Move tooltip\n\n          state.toolTipElem.style.top = \"\".concat(state.pointerPos.y, \"px\");\n          state.toolTipElem.style.left = \"\".concat(state.pointerPos.x, \"px\");\n          state.toolTipElem.style.transform = \"translate(-\".concat(state.pointerPos.x / state.width * 100, \"%, 21px)\"); // adjust horizontal position to not exceed canvas boundaries\n        }\n\n        function getOffset(el) {\n          var rect = el.getBoundingClientRect(),\n              scrollLeft = window.pageXOffset || document.documentElement.scrollLeft,\n              scrollTop = window.pageYOffset || document.documentElement.scrollTop;\n          return {\n            top: rect.top + scrollTop,\n            left: rect.left + scrollLeft\n          };\n        }\n      }, false);\n    }); // Handle click events on objs\n\n    state.container.addEventListener('pointerup', function (ev) {\n      if (state.isPointerDragging) {\n        state.isPointerDragging = false;\n        if (!state.clickAfterDrag) return; // don't trigger onClick after pointer drag (camera motion via controls)\n      }\n\n      if (ev.button === 0) {\n        // left-click\n        state.onClick(state.hoverObj || null, ev); // trigger background clicks with null\n      }\n\n      if (ev.button === 2 && state.onRightClick) {\n        // right-click\n        state.onRightClick(state.hoverObj || null, ev);\n      }\n    }, true); // use capture phase to prevent propagation blocking from controls (specifically for fly)\n\n    state.container.addEventListener('contextmenu', function (ev) {\n      if (state.onRightClick) ev.preventDefault(); // prevent default contextmenu behavior and allow pointerup to fire instead\n    }, false); // Setup renderer, camera and controls\n\n    state.renderer = new three.WebGLRenderer(Object.assign({\n      antialias: true,\n      alpha: true\n    }, rendererConfig));\n    state.renderer.setPixelRatio(window.devicePixelRatio);\n    state.container.appendChild(state.renderer.domElement); // configure post-processing composer\n\n    state.postProcessingComposer = new EffectComposer(state.renderer);\n    state.postProcessingComposer.addPass(new RenderPass(state.scene, state.camera)); // render scene as first pass\n    // configure controls\n\n    state.controls = new {\n      trackball: TrackballControls,\n      orbit: OrbitControls,\n      fly: FlyControls\n    }[controlType](state.camera, state.renderer.domElement);\n\n    if (controlType === 'fly') {\n      state.controls.movementSpeed = 300;\n      state.controls.rollSpeed = Math.PI / 6;\n      state.controls.dragToLook = true;\n    }\n\n    if (controlType === 'trackball' || controlType === 'orbit') {\n      state.controls.minDistance = 0.1;\n      state.controls.maxDistance = state.skyRadius;\n      state.controls.addEventListener('start', function () {\n        return state.controlsEngaged = true;\n      });\n      state.controls.addEventListener('change', function () {\n        if (state.controlsEngaged) {\n          state.controlsDragging = true;\n        }\n      });\n      state.controls.addEventListener('end', function () {\n        state.controlsEngaged = false;\n        state.controlsDragging = false;\n      });\n    }\n\n    state.renderer.setSize(state.width, state.height);\n    state.postProcessingComposer.setSize(state.width, state.height);\n    state.camera.aspect = state.width / state.height;\n    state.camera.updateProjectionMatrix();\n    state.camera.position.z = 1000; // add sky\n\n    state.scene.add(state.skysphere = new three.Mesh());\n    state.skysphere.visible = false;\n    state.loadComplete = state.scene.visible = !waitForLoadComplete;\n    window.scene = state.scene;\n  },\n  update: function update(state, changedProps) {\n    // resize canvas\n    if (state.width && state.height && (changedProps.hasOwnProperty('width') || changedProps.hasOwnProperty('height'))) {\n      state.container.style.width = state.width;\n      state.container.style.height = state.height;\n      state.renderer.setSize(state.width, state.height);\n      state.postProcessingComposer.setSize(state.width, state.height);\n      state.camera.aspect = state.width / state.height;\n      state.camera.updateProjectionMatrix();\n    }\n\n    if (changedProps.hasOwnProperty('skyRadius') && state.skyRadius) {\n      state.controls.hasOwnProperty('maxDistance') && changedProps.skyRadius && (state.controls.maxDistance = state.skyRadius);\n      state.camera.far = state.skyRadius * 2.5;\n      state.camera.updateProjectionMatrix();\n      state.skysphere.geometry = new three.SphereGeometry(state.skyRadius);\n    }\n\n    if (changedProps.hasOwnProperty('backgroundColor')) {\n      var alpha = parseToRgb(state.backgroundColor).alpha;\n      if (alpha === undefined) alpha = 1;\n      state.renderer.setClearColor(new three.Color(opacify(1, state.backgroundColor)), alpha);\n    }\n\n    if (changedProps.hasOwnProperty('backgroundImageUrl')) {\n      if (!state.backgroundImageUrl) {\n        state.skysphere.visible = false;\n        state.skysphere.material.map = null;\n        !state.loadComplete && finishLoad();\n      } else {\n        new three.TextureLoader().load(state.backgroundImageUrl, function (texture) {\n          state.skysphere.material = new three.MeshBasicMaterial({\n            map: texture,\n            side: three.BackSide\n          });\n          state.skysphere.visible = true; // triggered when background image finishes loading (asynchronously to allow 1 frame to load texture)\n\n          state.onBackgroundImageLoaded && setTimeout(state.onBackgroundImageLoaded);\n          !state.loadComplete && finishLoad();\n        });\n      }\n    }\n\n    changedProps.hasOwnProperty('showNavInfo') && (state.navInfo.style.display = state.showNavInfo ? null : 'none');\n\n    if (changedProps.hasOwnProperty('objects')) {\n      (changedProps.objects || []).forEach(function (obj) {\n        return state.scene.remove(obj);\n      }); // Clear the place\n\n      state.objects.forEach(function (obj) {\n        return state.scene.add(obj);\n      }); // Add to scene\n    } //\n\n\n    function finishLoad() {\n      state.loadComplete = state.scene.visible = true;\n    }\n  }\n});\nexport default threeRenderObjects;","map":{"version":3,"sources":["/Users/rgoren/Desktop/nextMoleAppClient/next_mole_client/node_modules/three-render-objects/dist/three-render-objects.module.js"],"names":["WebGLRenderer","Scene","PerspectiveCamera","Raycaster","TextureLoader","Vector2","Vector3","Box3","Color","Mesh","SphereGeometry","MeshBasicMaterial","BackSide","EventDispatcher","MOUSE","Quaternion","Spherical","Clock","TrackballControls","OrbitControls","FlyControls","EffectComposer","RenderPass","parseToRgb","opacify","TWEEN","accessorFn","Kapsule","styleInject","css","ref","insertAt","document","head","getElementsByTagName","style","createElement","type","firstChild","insertBefore","appendChild","styleSheet","cssText","createTextNode","css_248z","_defineProperty","obj","key","value","Object","defineProperty","enumerable","configurable","writable","_slicedToArray","arr","i","_arrayWithHoles","_iterableToArrayLimit","_unsupportedIterableToArray","_nonIterableRest","_toConsumableArray","_arrayWithoutHoles","_iterableToArray","_nonIterableSpread","Array","isArray","_arrayLikeToArray","iter","Symbol","iterator","from","_arr","_n","_d","_e","undefined","_i","_s","next","done","push","length","err","o","minLen","n","prototype","toString","call","slice","constructor","name","test","len","arr2","TypeError","three","window","THREE","threeRenderObjects","props","width","innerWidth","onChange","state","prevWidth","isNaN","height","innerHeight","prevHeight","backgroundColor","backgroundImageUrl","onBackgroundImageLoaded","showNavInfo","skyRadius","objects","enablePointerInteraction","_","hoverObj","toolTipElem","innerHTML","triggerUpdate","lineHoverPrecision","hoverOrderComparator","_default","hoverFilter","tooltipContent","hoverDuringDrag","clickAfterDrag","onHover","onClick","onRightClick","methods","tick","initialised","controls","update","clock","getDelta","postProcessingComposer","render","renderer","scene","camera","topObject","isPointerDragging","intersects","intersectingObjects","pointerPos","x","y","map","_ref","object","filter","sort","getPointerPos","_state$pointerPos","cameraPosition","position","lookAt","transitionDuration","finalPos","finalLookAt","z","setCameraPos","setLookAt","camPos","assign","camLookAt","getLookAt","Tween","to","easing","Easing","Quadratic","Out","onUpdate","start","pos","target","applyQuaternion","quaternion","add","zoomToFit","arguments","padding","_len","bboxArgs","_key","fitToBbox","getBbox","apply","bbox","center","maxBoxSide","Math","max","entries","_ref2","_ref3","coordType","coords","c","abs","paddedFov","fov","fitHeightDistance","atan","PI","fitWidthDistance","aspect","distance","newCameraPosition","clone","sub","normalize","multiplyScalar","objFilter","box","objs","forEach","expandByObject","min","getScreenCoords","vec","project","relCoords","raycaster","params","Line","threshold","setFromCamera","intersectObjects","tbControls","stateInit","init","domNode","_ref5","_ref5$controlType","controlType","_ref5$rendererConfig","rendererConfig","_ref5$waitForLoadComp","waitForLoadComplete","container","navInfo","className","textContent","orbit","trackball","fly","display","classList","evType","addEventListener","ev","pressure","movementX","movementY","offset","getOffset","pageX","left","pageY","top","concat","transform","el","rect","getBoundingClientRect","scrollLeft","pageXOffset","documentElement","scrollTop","pageYOffset","button","preventDefault","antialias","alpha","setPixelRatio","devicePixelRatio","domElement","addPass","movementSpeed","rollSpeed","dragToLook","minDistance","maxDistance","controlsEngaged","controlsDragging","setSize","updateProjectionMatrix","skysphere","visible","loadComplete","changedProps","hasOwnProperty","far","geometry","setClearColor","material","finishLoad","load","texture","side","setTimeout","remove"],"mappings":"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","sourcesContent":["import { WebGLRenderer, Scene, PerspectiveCamera, Raycaster, TextureLoader, Vector2, Vector3, Box3, Color, Mesh, SphereGeometry, MeshBasicMaterial, BackSide, EventDispatcher, MOUSE, Quaternion, Spherical, Clock } from 'three';\nimport { TrackballControls } from 'three/examples/jsm/controls/TrackballControls.js';\nimport { OrbitControls } from 'three/examples/jsm/controls/OrbitControls.js';\nimport { FlyControls } from 'three/examples/jsm/controls/FlyControls.js';\nimport { EffectComposer } from 'three/examples/jsm/postprocessing/EffectComposer.js';\nimport { RenderPass } from 'three/examples/jsm/postprocessing/RenderPass.js';\nimport { parseToRgb, opacify } from 'polished';\nimport TWEEN from '@tweenjs/tween.js';\nimport accessorFn from 'accessor-fn';\nimport Kapsule from 'kapsule';\n\nfunction styleInject(css, ref) {\n  if (ref === void 0) ref = {};\n  var insertAt = ref.insertAt;\n\n  if (!css || typeof document === 'undefined') {\n    return;\n  }\n\n  var head = document.head || document.getElementsByTagName('head')[0];\n  var style = document.createElement('style');\n  style.type = 'text/css';\n\n  if (insertAt === 'top') {\n    if (head.firstChild) {\n      head.insertBefore(style, head.firstChild);\n    } else {\n      head.appendChild(style);\n    }\n  } else {\n    head.appendChild(style);\n  }\n\n  if (style.styleSheet) {\n    style.styleSheet.cssText = css;\n  } else {\n    style.appendChild(document.createTextNode(css));\n  }\n}\n\nvar css_248z = \".scene-nav-info {\\n  bottom: 5px;\\n  width: 100%;\\n  text-align: center;\\n  color: slategrey;\\n  opacity: 0.7;\\n  font-size: 10px;\\n}\\n\\n.scene-tooltip {\\n  color: lavender;\\n  font-size: 15px;\\n}\\n\\n.scene-nav-info, .scene-tooltip {\\n  position: absolute;\\n  font-family: sans-serif;\\n  pointer-events: none;\\n}\";\nstyleInject(css_248z);\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nfunction _slicedToArray(arr, i) {\n  return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest();\n}\n\nfunction _toConsumableArray(arr) {\n  return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread();\n}\n\nfunction _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) return _arrayLikeToArray(arr);\n}\n\nfunction _arrayWithHoles(arr) {\n  if (Array.isArray(arr)) return arr;\n}\n\nfunction _iterableToArray(iter) {\n  if (typeof Symbol !== \"undefined\" && Symbol.iterator in Object(iter)) return Array.from(iter);\n}\n\nfunction _iterableToArrayLimit(arr, i) {\n  if (typeof Symbol === \"undefined\" || !(Symbol.iterator in Object(arr))) return;\n  var _arr = [];\n  var _n = true;\n  var _d = false;\n  var _e = undefined;\n\n  try {\n    for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) {\n      _arr.push(_s.value);\n\n      if (i && _arr.length === i) break;\n    }\n  } catch (err) {\n    _d = true;\n    _e = err;\n  } finally {\n    try {\n      if (!_n && _i[\"return\"] != null) _i[\"return\"]();\n    } finally {\n      if (_d) throw _e;\n    }\n  }\n\n  return _arr;\n}\n\nfunction _unsupportedIterableToArray(o, minLen) {\n  if (!o) return;\n  if (typeof o === \"string\") return _arrayLikeToArray(o, minLen);\n  var n = Object.prototype.toString.call(o).slice(8, -1);\n  if (n === \"Object\" && o.constructor) n = o.constructor.name;\n  if (n === \"Map\" || n === \"Set\") return Array.from(o);\n  if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);\n}\n\nfunction _arrayLikeToArray(arr, len) {\n  if (len == null || len > arr.length) len = arr.length;\n\n  for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];\n\n  return arr2;\n}\n\nfunction _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\n\nfunction _nonIterableRest() {\n  throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\n\nvar three = window.THREE ? window.THREE // Prefer consumption from global THREE, if exists\n: {\n  WebGLRenderer: WebGLRenderer,\n  Scene: Scene,\n  PerspectiveCamera: PerspectiveCamera,\n  Raycaster: Raycaster,\n  TextureLoader: TextureLoader,\n  Vector2: Vector2,\n  Vector3: Vector3,\n  Box3: Box3,\n  Color: Color,\n  Mesh: Mesh,\n  SphereGeometry: SphereGeometry,\n  MeshBasicMaterial: MeshBasicMaterial,\n  BackSide: BackSide,\n  EventDispatcher: EventDispatcher,\n  MOUSE: MOUSE,\n  Quaternion: Quaternion,\n  Spherical: Spherical,\n  Clock: Clock\n};\nvar threeRenderObjects = Kapsule({\n  props: {\n    width: {\n      \"default\": window.innerWidth,\n      onChange: function onChange(width, state, prevWidth) {\n        isNaN(width) && (state.width = prevWidth);\n      }\n    },\n    height: {\n      \"default\": window.innerHeight,\n      onChange: function onChange(height, state, prevHeight) {\n        isNaN(height) && (state.height = prevHeight);\n      }\n    },\n    backgroundColor: {\n      \"default\": '#000011'\n    },\n    backgroundImageUrl: {},\n    onBackgroundImageLoaded: {},\n    showNavInfo: {\n      \"default\": true\n    },\n    skyRadius: {\n      \"default\": 50000\n    },\n    objects: {\n      \"default\": []\n    },\n    enablePointerInteraction: {\n      \"default\": true,\n      onChange: function onChange(_, state) {\n        // Reset hover state\n        state.hoverObj = null;\n        if (state.toolTipElem) state.toolTipElem.innerHTML = '';\n      },\n      triggerUpdate: false\n    },\n    lineHoverPrecision: {\n      \"default\": 1,\n      triggerUpdate: false\n    },\n    hoverOrderComparator: {\n      \"default\": function _default() {\n        return -1;\n      },\n      triggerUpdate: false\n    },\n    // keep existing order by default\n    hoverFilter: {\n      \"default\": function _default() {\n        return true;\n      },\n      triggerUpdate: false\n    },\n    // exclude objects from interaction\n    tooltipContent: {\n      triggerUpdate: false\n    },\n    hoverDuringDrag: {\n      \"default\": false,\n      triggerUpdate: false\n    },\n    clickAfterDrag: {\n      \"default\": false,\n      triggerUpdate: false\n    },\n    onHover: {\n      \"default\": function _default() {},\n      triggerUpdate: false\n    },\n    onClick: {\n      \"default\": function _default() {},\n      triggerUpdate: false\n    },\n    onRightClick: {\n      triggerUpdate: false\n    }\n  },\n  methods: {\n    tick: function tick(state) {\n      if (state.initialised) {\n        state.controls.update && state.controls.update(state.clock.getDelta()); // timedelta is required for fly controls\n\n        state.postProcessingComposer ? state.postProcessingComposer.render() // if using postprocessing, switch the output to it\n        : state.renderer.render(state.scene, state.camera);\n\n        if (state.enablePointerInteraction) {\n          // Update tooltip and trigger onHover events\n          var topObject = null;\n\n          if (state.hoverDuringDrag || !state.isPointerDragging) {\n            var intersects = this.intersectingObjects(state.pointerPos.x, state.pointerPos.y).map(function (_ref) {\n              var object = _ref.object;\n              return object;\n            }).filter(state.hoverFilter).sort(state.hoverOrderComparator);\n            topObject = intersects.length ? intersects[0] : null;\n          }\n\n          if (topObject !== state.hoverObj) {\n            state.onHover(topObject, state.hoverObj);\n            state.toolTipElem.innerHTML = topObject ? accessorFn(state.tooltipContent)(topObject) || '' : '';\n            state.hoverObj = topObject;\n          }\n        }\n\n        TWEEN.update(); // update camera animation tweens\n      }\n\n      return this;\n    },\n    getPointerPos: function getPointerPos(state) {\n      var _state$pointerPos = state.pointerPos,\n          x = _state$pointerPos.x,\n          y = _state$pointerPos.y;\n      return {\n        x: x,\n        y: y\n      };\n    },\n    cameraPosition: function cameraPosition(state, position, lookAt, transitionDuration) {\n      var camera = state.camera; // Setter\n\n      if (position && state.initialised) {\n        var finalPos = position;\n        var finalLookAt = lookAt || {\n          x: 0,\n          y: 0,\n          z: 0\n        };\n\n        if (!transitionDuration) {\n          // no animation\n          setCameraPos(finalPos);\n          setLookAt(finalLookAt);\n        } else {\n          var camPos = Object.assign({}, camera.position);\n          var camLookAt = getLookAt();\n          new TWEEN.Tween(camPos).to(finalPos, transitionDuration).easing(TWEEN.Easing.Quadratic.Out).onUpdate(setCameraPos).start(); // Face direction in 1/3rd of time\n\n          new TWEEN.Tween(camLookAt).to(finalLookAt, transitionDuration / 3).easing(TWEEN.Easing.Quadratic.Out).onUpdate(setLookAt).start();\n        }\n\n        return this;\n      } // Getter\n\n\n      return Object.assign({}, camera.position, {\n        lookAt: getLookAt()\n      }); //\n\n      function setCameraPos(pos) {\n        var x = pos.x,\n            y = pos.y,\n            z = pos.z;\n        if (x !== undefined) camera.position.x = x;\n        if (y !== undefined) camera.position.y = y;\n        if (z !== undefined) camera.position.z = z;\n      }\n\n      function setLookAt(lookAt) {\n        state.controls.target = new three.Vector3(lookAt.x, lookAt.y, lookAt.z);\n      }\n\n      function getLookAt() {\n        return Object.assign(new three.Vector3(0, 0, -1000).applyQuaternion(camera.quaternion).add(camera.position));\n      }\n    },\n    zoomToFit: function zoomToFit(state) {\n      var transitionDuration = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;\n      var padding = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 10;\n\n      for (var _len = arguments.length, bboxArgs = new Array(_len > 3 ? _len - 3 : 0), _key = 3; _key < _len; _key++) {\n        bboxArgs[_key - 3] = arguments[_key];\n      }\n\n      return this.fitToBbox(this.getBbox.apply(this, bboxArgs), transitionDuration, padding);\n    },\n    fitToBbox: function fitToBbox(state, bbox) {\n      var transitionDuration = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;\n      var padding = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 10;\n      // based on https://discourse.threejs.org/t/camera-zoom-to-fit-object/936/24\n      var camera = state.camera;\n\n      if (bbox) {\n        var center = new three.Vector3(0, 0, 0); // reset camera aim to center\n\n        var maxBoxSide = Math.max.apply(Math, _toConsumableArray(Object.entries(bbox).map(function (_ref2) {\n          var _ref3 = _slicedToArray(_ref2, 2),\n              coordType = _ref3[0],\n              coords = _ref3[1];\n\n          return Math.max.apply(Math, _toConsumableArray(coords.map(function (c) {\n            return Math.abs(center[coordType] - c);\n          })));\n        }))) * 2; // find distance that fits whole bbox within padded fov\n\n        var paddedFov = (1 - padding * 2 / state.height) * camera.fov;\n        var fitHeightDistance = maxBoxSide / Math.atan(paddedFov * Math.PI / 180);\n        var fitWidthDistance = fitHeightDistance / camera.aspect;\n        var distance = Math.max(fitHeightDistance, fitWidthDistance);\n\n        if (distance > 0) {\n          var newCameraPosition = center.clone().sub(camera.position).normalize().multiplyScalar(-distance);\n          this.cameraPosition(newCameraPosition, center, transitionDuration);\n        }\n      }\n\n      return this;\n    },\n    getBbox: function getBbox(state) {\n      var objFilter = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : function () {\n        return true;\n      };\n      var box = new three.Box3(new three.Vector3(0, 0, 0), new three.Vector3(0, 0, 0));\n      var objs = state.objects.filter(objFilter);\n      if (!objs.length) return null;\n      objs.forEach(function (obj) {\n        return box.expandByObject(obj);\n      }); // extract global x,y,z min/max\n\n      return Object.assign.apply(Object, _toConsumableArray(['x', 'y', 'z'].map(function (c) {\n        return _defineProperty({}, c, [box.min[c], box.max[c]]);\n      })));\n    },\n    getScreenCoords: function getScreenCoords(state, x, y, z) {\n      var vec = new three.Vector3(x, y, z);\n      vec.project(this.camera()); // project to the camera plane\n\n      return {\n        // align relative pos to canvas dimensions\n        x: (vec.x + 1) * state.width / 2,\n        y: -(vec.y - 1) * state.height / 2\n      };\n    },\n    intersectingObjects: function intersectingObjects(state, x, y) {\n      var relCoords = new three.Vector2(x / state.width * 2 - 1, -(y / state.height) * 2 + 1);\n      var raycaster = new three.Raycaster();\n      raycaster.params.Line.threshold = state.lineHoverPrecision; // set linePrecision\n\n      raycaster.setFromCamera(relCoords, state.camera);\n      return raycaster.intersectObjects(state.objects, true);\n    },\n    renderer: function renderer(state) {\n      return state.renderer;\n    },\n    scene: function scene(state) {\n      return state.scene;\n    },\n    camera: function camera(state) {\n      return state.camera;\n    },\n    postProcessingComposer: function postProcessingComposer(state) {\n      return state.postProcessingComposer;\n    },\n    controls: function controls(state) {\n      return state.controls;\n    },\n    tbControls: function tbControls(state) {\n      return state.controls;\n    } // to be deprecated\n\n  },\n  stateInit: function stateInit() {\n    return {\n      scene: new three.Scene(),\n      camera: new three.PerspectiveCamera(),\n      clock: new three.Clock()\n    };\n  },\n  init: function init(domNode, state, _ref5) {\n    var _ref5$controlType = _ref5.controlType,\n        controlType = _ref5$controlType === void 0 ? 'trackball' : _ref5$controlType,\n        _ref5$rendererConfig = _ref5.rendererConfig,\n        rendererConfig = _ref5$rendererConfig === void 0 ? {} : _ref5$rendererConfig,\n        _ref5$waitForLoadComp = _ref5.waitForLoadComplete,\n        waitForLoadComplete = _ref5$waitForLoadComp === void 0 ? true : _ref5$waitForLoadComp;\n    // Wipe DOM\n    domNode.innerHTML = ''; // Add relative container\n\n    domNode.appendChild(state.container = document.createElement('div'));\n    state.container.style.position = 'relative'; // Add nav info section\n\n    state.container.appendChild(state.navInfo = document.createElement('div'));\n    state.navInfo.className = 'scene-nav-info';\n    state.navInfo.textContent = {\n      orbit: 'Left-click: rotate, Mouse-wheel/middle-click: zoom, Right-click: pan',\n      trackball: 'Left-click: rotate, Mouse-wheel/middle-click: zoom, Right-click: pan',\n      fly: 'WASD: move, R|F: up | down, Q|E: roll, up|down: pitch, left|right: yaw'\n    }[controlType] || '';\n    state.navInfo.style.display = state.showNavInfo ? null : 'none'; // Setup tooltip\n\n    state.toolTipElem = document.createElement('div');\n    state.toolTipElem.classList.add('scene-tooltip');\n    state.container.appendChild(state.toolTipElem); // Capture pointer coords on move or touchstart\n\n    state.pointerPos = new three.Vector2();\n    state.pointerPos.x = -2; // Initialize off canvas\n\n    state.pointerPos.y = -2;\n    ['pointermove', 'pointerdown'].forEach(function (evType) {\n      return state.container.addEventListener(evType, function (ev) {\n        // detect point drag\n        !state.isPointerDragging && ev.type === 'pointermove' && ev.pressure > 0 && (ev.movementX !== 0 || ev.movementY !== 0) && (state.isPointerDragging = true);\n\n        if (state.enablePointerInteraction) {\n          // update the pointer pos\n          var offset = getOffset(state.container);\n          state.pointerPos.x = ev.pageX - offset.left;\n          state.pointerPos.y = ev.pageY - offset.top; // Move tooltip\n\n          state.toolTipElem.style.top = \"\".concat(state.pointerPos.y, \"px\");\n          state.toolTipElem.style.left = \"\".concat(state.pointerPos.x, \"px\");\n          state.toolTipElem.style.transform = \"translate(-\".concat(state.pointerPos.x / state.width * 100, \"%, 21px)\"); // adjust horizontal position to not exceed canvas boundaries\n        }\n\n        function getOffset(el) {\n          var rect = el.getBoundingClientRect(),\n              scrollLeft = window.pageXOffset || document.documentElement.scrollLeft,\n              scrollTop = window.pageYOffset || document.documentElement.scrollTop;\n          return {\n            top: rect.top + scrollTop,\n            left: rect.left + scrollLeft\n          };\n        }\n      }, false);\n    }); // Handle click events on objs\n\n    state.container.addEventListener('pointerup', function (ev) {\n      if (state.isPointerDragging) {\n        state.isPointerDragging = false;\n        if (!state.clickAfterDrag) return; // don't trigger onClick after pointer drag (camera motion via controls)\n      }\n\n      if (ev.button === 0) {\n        // left-click\n        state.onClick(state.hoverObj || null, ev); // trigger background clicks with null\n      }\n\n      if (ev.button === 2 && state.onRightClick) {\n        // right-click\n        state.onRightClick(state.hoverObj || null, ev);\n      }\n    }, true); // use capture phase to prevent propagation blocking from controls (specifically for fly)\n\n    state.container.addEventListener('contextmenu', function (ev) {\n      if (state.onRightClick) ev.preventDefault(); // prevent default contextmenu behavior and allow pointerup to fire instead\n    }, false); // Setup renderer, camera and controls\n\n    state.renderer = new three.WebGLRenderer(Object.assign({\n      antialias: true,\n      alpha: true\n    }, rendererConfig));\n    state.renderer.setPixelRatio(window.devicePixelRatio);\n    state.container.appendChild(state.renderer.domElement); // configure post-processing composer\n\n    state.postProcessingComposer = new EffectComposer(state.renderer);\n    state.postProcessingComposer.addPass(new RenderPass(state.scene, state.camera)); // render scene as first pass\n    // configure controls\n\n    state.controls = new {\n      trackball: TrackballControls,\n      orbit: OrbitControls,\n      fly: FlyControls\n    }[controlType](state.camera, state.renderer.domElement);\n\n    if (controlType === 'fly') {\n      state.controls.movementSpeed = 300;\n      state.controls.rollSpeed = Math.PI / 6;\n      state.controls.dragToLook = true;\n    }\n\n    if (controlType === 'trackball' || controlType === 'orbit') {\n      state.controls.minDistance = 0.1;\n      state.controls.maxDistance = state.skyRadius;\n      state.controls.addEventListener('start', function () {\n        return state.controlsEngaged = true;\n      });\n      state.controls.addEventListener('change', function () {\n        if (state.controlsEngaged) {\n          state.controlsDragging = true;\n        }\n      });\n      state.controls.addEventListener('end', function () {\n        state.controlsEngaged = false;\n        state.controlsDragging = false;\n      });\n    }\n\n    state.renderer.setSize(state.width, state.height);\n    state.postProcessingComposer.setSize(state.width, state.height);\n    state.camera.aspect = state.width / state.height;\n    state.camera.updateProjectionMatrix();\n    state.camera.position.z = 1000; // add sky\n\n    state.scene.add(state.skysphere = new three.Mesh());\n    state.skysphere.visible = false;\n    state.loadComplete = state.scene.visible = !waitForLoadComplete;\n    window.scene = state.scene;\n  },\n  update: function update(state, changedProps) {\n    // resize canvas\n    if (state.width && state.height && (changedProps.hasOwnProperty('width') || changedProps.hasOwnProperty('height'))) {\n      state.container.style.width = state.width;\n      state.container.style.height = state.height;\n      state.renderer.setSize(state.width, state.height);\n      state.postProcessingComposer.setSize(state.width, state.height);\n      state.camera.aspect = state.width / state.height;\n      state.camera.updateProjectionMatrix();\n    }\n\n    if (changedProps.hasOwnProperty('skyRadius') && state.skyRadius) {\n      state.controls.hasOwnProperty('maxDistance') && changedProps.skyRadius && (state.controls.maxDistance = state.skyRadius);\n      state.camera.far = state.skyRadius * 2.5;\n      state.camera.updateProjectionMatrix();\n      state.skysphere.geometry = new three.SphereGeometry(state.skyRadius);\n    }\n\n    if (changedProps.hasOwnProperty('backgroundColor')) {\n      var alpha = parseToRgb(state.backgroundColor).alpha;\n      if (alpha === undefined) alpha = 1;\n      state.renderer.setClearColor(new three.Color(opacify(1, state.backgroundColor)), alpha);\n    }\n\n    if (changedProps.hasOwnProperty('backgroundImageUrl')) {\n      if (!state.backgroundImageUrl) {\n        state.skysphere.visible = false;\n        state.skysphere.material.map = null;\n        !state.loadComplete && finishLoad();\n      } else {\n        new three.TextureLoader().load(state.backgroundImageUrl, function (texture) {\n          state.skysphere.material = new three.MeshBasicMaterial({\n            map: texture,\n            side: three.BackSide\n          });\n          state.skysphere.visible = true; // triggered when background image finishes loading (asynchronously to allow 1 frame to load texture)\n\n          state.onBackgroundImageLoaded && setTimeout(state.onBackgroundImageLoaded);\n          !state.loadComplete && finishLoad();\n        });\n      }\n    }\n\n    changedProps.hasOwnProperty('showNavInfo') && (state.navInfo.style.display = state.showNavInfo ? null : 'none');\n\n    if (changedProps.hasOwnProperty('objects')) {\n      (changedProps.objects || []).forEach(function (obj) {\n        return state.scene.remove(obj);\n      }); // Clear the place\n\n      state.objects.forEach(function (obj) {\n        return state.scene.add(obj);\n      }); // Add to scene\n    } //\n\n\n    function finishLoad() {\n      state.loadComplete = state.scene.visible = true;\n    }\n  }\n});\n\nexport default threeRenderObjects;\n"]},"metadata":{},"sourceType":"module"}